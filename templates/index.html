<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Asisten Virtual Skincare</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #e546b5;
      --secondary: #f8a8d8;
      --accent: #ffd6f0;
      --light: #fff9fc;
      --dark: #3a0e2a;
    }
    
    .hidden { display: none; }
    .disabled-button {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    /* Product Card */
    .product-card {
      background: white;
      border-radius: 16px;
      overflow: hidden;
      width: 220px;
      margin: 12px;
      box-shadow: 0 6px 20px rgba(229, 70, 181, 0.12);
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      border: 1px solid rgba(229, 70, 181, 0.15);
    }
    
    .product-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 30px rgba(229, 70, 181, 0.2);
    }
    
    .product-image-container {
      background: linear-gradient(135deg, #fff9fc 0%, #ffecf7 100%);
      padding: 15px;
    }
    
    .product-image {
      width: 100%;
      height: 150px;
      object-fit: contain;
      transition: transform 0.3s ease;
    }
    
    .product-card:hover .product-image {
      transform: scale(1.05);
    }
    
    .product-name {
      font-size: 15px;
      font-weight: 600;
      padding: 12px;
      color: var(--dark);
      text-align: center;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .product-footer {
      padding: 12px 16px 16px;
      display: flex;
      justify-content: center;
    }
    
    .detail-btn {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 16px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      box-shadow: 0 4px 8px rgba(229, 70, 181, 0.2);
      letter-spacing: 0.5px;
    }
    
    .detail-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(229, 70, 181, 0.3);
    }
    
    /* Chat Container */
    .chat-container {
      scrollbar-width: thin;
      scrollbar-color: var(--secondary) var(--light);
      background-color: var(--light);
    }
    
    .chat-container::-webkit-scrollbar {
      width: 8px;
    }
    
    .chat-container::-webkit-scrollbar-track {
      background: var(--light);
      border-radius: 10px;
    }
    
    .chat-container::-webkit-scrollbar-thumb {
      background-color: var(--secondary);
      border-radius: 10px;
      border: 2px solid var(--light);
    }
    
    /* Message Bubbles */
    .user-message-bubble {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      border-radius: 24px 24px 6px 24px;
      max-width: 80%;
      box-shadow: 0 4px 12px rgba(229, 70, 181, 0.15);
    }
    
    .bot-message-bubble {
      background: white;
      color: var(--dark);
      border-radius: 24px 24px 24px 6px;
      max-width: 80%;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    
    /* Header */
    .app-header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      box-shadow: 0 6px 20px rgba(229, 70, 181, 0.25);
    }
    
    /* Input */
    .chat-input {
      background: white;
      border: 1px solid rgba(229, 70, 181, 0.2);
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .chat-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(229, 70, 181, 0.15);
    }
    
    .send-button {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      box-shadow: 0 4px 10px rgba(229, 70, 181, 0.25);
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    
    .send-button:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 20px rgba(229, 70, 181, 0.3);
    }
    
    /* Footer Gradient */
    .color-gradient-bar {
      height: 6px;
      background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 50%, var(--accent) 100%);
    }
    
    /* Typing Indicator */
    .typing-indicator {
      background: white;
      border-radius: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    
    /* Modal */
    .product-modal {
      background: rgba(0,0,0,0.4);
      backdrop-filter: blur(8px);
    }
    
    .modal-content {
      background: white;
      box-shadow: 0 10px 40px rgba(0,0,0,0.15);
    }
    
    .modal-image-container {
      background: linear-gradient(135deg, #fff9fc 0%, #ffecf7 100%);
    }
    
    /* Scroll Buttons */
    .scroll-button {
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      transform: translateY(20px);
    }
    
    .scroll-button.visible {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    
   
    /* Perbaikan untuk Modal Pedoman */
    .guide-modal {
      position: fixed;
      inset: 0;
      z-index: 50;
      display: none;
      align-items: flex-start; /* Diubah dari center ke flex-start */
      justify-content: center;
      padding: 1rem;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(6px);
      overflow-y: auto; /* Tambahkan scroll jika konten panjang */
    }
    
    .guide-modal-content {
      width: 100%;
      max-width: 600px;
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
      margin: 2rem 0; /* Beri margin atas bawah */
    }
    
    .guide-step {
      display: flex;
      align-items: flex-start;
      margin-bottom: 20px;
      padding: 15px;
      border-radius: 12px;
      transition: all 0.3s ease;
      background: rgba(248, 168, 216, 0.1);
    }
    .guide-step:hover {
      background: rgba(248, 168, 216, 0.2);
      transform: translateX(5px);
    }
    .step-number {
      min-width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-right: 15px;
      flex-shrink: 0;
    }
    /* ANIMASI PESAN BARU */
    .message-container {
      opacity: 0;
      transform: scale(0.95);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .message-container.user {
      transform-origin: right bottom;
    }
    
    .message-container.bot {
      transform-origin: left bottom;
    }
    
    .message-container.visible {
      opacity: 1;
      transform: scale(1);
    }
/* Style untuk tombol feedback */
.feedback-buttons {
    gap: 15px;
    margin-top: 25px;
}
/* Container utama statistik */
.stat-response {
    margin: 20px 0;
    padding: 15px;
    background: #f9f9ff;
    border-radius: 15px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}

/* Grid untuk kartu statistik */
.stat-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

/* Kartu statistik individual */
.stat-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 4px 8px rgba(0,0,0,0.08);
    transition: transform 0.3s ease;
    border: 1px solid #eaeaea;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.1);
}

.stat-card-highlight {
    background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
    color: white;
}

.stat-card-highlight .stat-icon,
.stat-card-highlight .stat-title,
.stat-card-highlight .stat-value,
.stat-card-highlight .stat-desc {
    color: white;
}

.stat-icon {
    font-size: 3rem;
    margin-bottom: 15px;
    color: #6c63ff;
}

.stat-title {
    font-weight: 600;
    font-size: 1.1rem;
    margin-bottom: 10px;
    color: #333;
}

.stat-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: #6c63ff;
    margin: 10px 0;
}

.stat-desc {
    font-size: 0.9rem;
    color: #666;
}

/* Grafik statistik */
.stat-charts {
    margin-top: 30px;
}

.stat-chart {
    margin-bottom: 30px;
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.05);
}

.chart-title {
    font-weight: 600;
    font-size: 1.2rem;
    margin-bottom: 15px;
    color: #444;
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
}

.chart-item {
    margin-bottom: 15px;
}

.chart-label {
    font-size: 0.95rem;
    margin-bottom: 5px;
    color: #555;
}

.chart-bar {
    height: 28px;
    background: #f0f0f0;
    border-radius: 14px;
    overflow: hidden;
    position: relative;
}

.chart-fill {
    height: 100%;
    background: linear-gradient(90deg, #6c63ff, #4a44b8);
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    min-width: 40px;
    transition: width 1s ease;
}

.chart-value {
    color: white;
    font-weight: 600;
    font-size: 0.85rem;
    padding-right: 12px;
}

.feedback-btn {
     padding: 12px 25px;
     border-radius: 16px;;
     font-weight: 500;
     display: flex;
     align-items: center;
     transition: all 0.3s ease;
     border: none;
     cursor: pointer;
     font-size: 15px;
}

.feedback-btn.more {
    background: linear-gradient(135deg, #e546b5, #d434a5);
    color: white;
    box-shadow: 0 5px 15px rgba(229, 70, 181, 0.3);
}

.feedback-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(229, 70, 181, 0.4);
}

.feedback-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.feedback-note {
    margin-top: 15px;
    font-size: 0.9rem;
    color: #666;
}
/* Styling untuk bagian "Produk Tidak Ditemukan" */
.no-recommendation {  
    overflow: hidden;
    padding: 10px;
    border-radius: 16px;
    background: white;
    text-align: center;
}

.floating-element {
    position: absolute;
    border-radius: 50%;
    opacity: 0.1;
}

.sad-icon {
    width: 30px;
    height: 30px;
    background: linear-gradient(35deg, var(--primary) 0%, var(--secondary) 100%);
    border-radius: 50%;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    color: white;
}

.rag-response h5 {
    font-size: 1.25rem;
    font-weight: bold;
    color: var(--dark);
    margin-bottom: 10px;
}

.rag-response p {
    color: #666;
    margin-bottom: 20px;
}

.suggestion-box {
            background: linear-gradient(135deg, #fdf5ff, #f9f0ff);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid #f0d9e9;
            position: relative;
            overflow: hidden;
        }
        
        .suggestion-box:before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(to bottom, #e546b5, #f8a8d8);
        }
        
        .suggestion-box h4 {
            font-size: 18px;
            font-weight: 600;
            color: #7d2249;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .suggestion-box h4 i {
            margin-right: 10px;
            color: #e546b5;
        }
        
        .suggestion-list {
            list-style: none;
            padding: 0;
        }
        
        .suggestion-list li {
            padding: 12px 15px;
            margin: 10px 0;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.03);
            transition: all 0.3s ease;
            border-left: 3px solid #f8a8d8;
        }
        
        .suggestion-list li:hover {
            transform: translateX(5px);
            border-left: 3px solid #e546b5;
            box-shadow: 0 5px 15px rgba(229, 70, 181, 0.1);
        }
        
        .suggestion-list li i {
            width: 28px;
            height: 28px;
            background: #ffd6f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: #e546b5;
            font-size: 14px;
        }
        
        .timestamp {
            color: #aaa;
            font-size: 12px;
            text-align: right;
            padding: 10px 15px 5px;
            border-top: 1px dashed #eee;
            margin-top: 15px;
        }

    @media (max-width: 640px) {
      .input-container {
        padding-left: 0.75rem;
        padding-right: 0.75rem;
      }
      
      .product-card {
        width: 180px;
        margin: 8px;
      }
      
      .product-name {
        font-size: 14px;
        min-height: 50px;
      }
      
      .detail-btn {
        padding: 8px 16px;
        font-size: 13px;
      }
      
       .guide-modal-content {
        width: 90%;
      }
      
      .guide-step {
        flex-direction: column;
      }
      
      .step-number {
        margin-bottom: 10px;
      }
      
      .location-tabs {
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .location-tabs button {
        width: 100%;
        text-align: center;
        padding: 0.5rem;
        font-size: 0.8rem;
      }
      
      .modal-content, .guide-modal-content {
        max-height: 85vh;
        overflow-y: auto;
      }
      
      .guide-modal {
        align-items: flex-start;
        padding-top: 1rem;
      }
      
      .modal-image-container {
        padding: 10px;
      }
      
      #modalLocation {
        height: 200px;
      }
    }
    
    /* Perbaikan scroll modal */
    .modal-content, .guide-modal-content {
      max-height: 90vh;
      overflow-y: auto;
    }
    
  </style>
</head>
<body class="bg-[#fff9fc] h-screen flex flex-col font-sans selection:bg-pink-200 selection:text-pink-900">

  <!-- Header with Gradient -->
  <header class="app-header text-white p-4">
    <div class="container mx-auto flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center shadow-sm">
          <i class="fas fa-spa text-white text-xl"></i>
        </div>
        <h1 class="text-white text-2xl font-bold">Asisten Virtual</h1>
      </div>
      <button id="guideButton" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-full flex items-center space-x-2 transition">
        <i class="fas fa-book"></i>
        <span>Pedoman</span>
      </button>
    </div>
  </header>
  
  <!-- Chat Container -->
  <div class="flex-1 overflow-y-auto p-4 chat-container" id="chatContainer">
    <div class="container mx-auto max-w-3xl space-y-4" id="chatMessages">
      <!-- Welcome Message -->
      <div class="flex items-end space-x-3">
  <div class="bot-message-bubble px-5 py-4 relative">
    <!-- Decorative elements -->
    <div class="absolute top-0 left-0 w-full h-full overflow-hidden rounded-2xl opacity-10 pointer-events-none">
      <div class="absolute -top-2 -left-2 w-16 h-16 rounded-full bg-pink-200"></div>
      <div class="absolute -bottom-4 -right-4 w-24 h-24 rounded-full bg-purple-200"></div>
    </div>
    
    <!-- Main content -->
    <div class="relative z-10">
      <p class="font-bold text-[#e546b5] text-lg mb-3">Hello! üëã</p>
      <p class="text-gray-700 mb-4">Saya asisten rekomendasi skincare yang akan membantu Anda menemukan produk terbaik untuk kebutuhan kulit Anda.</p>
      
      <div class=" border-l-4 border-pink-300 p-3 rounded-r-lg mb-4">
        <p class="font-bold text-[#e546b5] mb-1">Kamu bisa bertanya sepert ini:</p>
        <ul role="list" class="list-disc marker:text-pink-400 list-inside text-gray-900 text-sm mt-1 space-y-1">
          <li>Serum untuk kulit kering</li>
          <li>Manfaat GARNIER SAKURA GLOW FACE WASH</li>
        </ul>
      </div>
    </div>
  </div>
</div>
    </div>
  </div>
  
  <!-- Input Area -->
  <div class="pb-4 sm:pb-24 lg:pb-4 input-container backdrop-blur-sm">
    <div class="container mx-auto max-w-3xl">
      <form id="chatForm" class="flex items-center gap-3 w-full">
        <input id="userInput" 
               type="text" 
               placeholder="Ketik pertanyaan tentang produk skincare..." 
               class="flex-1 p-4 rounded-full chat-input focus:outline-none pl-5 pr-5"
               autocomplete="off"
               maxlength="120"/>
        <button id="submitButton" 
                type="submit" 
                class="w-12 h-12 flex-shrink-0 rounded-full send-button text-white flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
          <i id="sendIcon" class="fas fa-paper-plane"></i>
          <i id="loadingIcon" class="fas fa-spinner fa-spin hidden"></i>
        </button>
      </form>
    </div>
  </div>
  
  <!-- Scroll Up and Down Buttons -->
  <div class="fixed bottom-24 right-4 flex flex-col gap-2">
    <button id="scrollUpButton" class="scroll-button p-2 rounded-full bg-[#e546b5] text-white shadow-lg hover:bg-[#f8a8d8]">
      <i class="fas fa-arrow-up"></i>
    </button>
    <button id="scrollDownButton" class="scroll-button p-2 rounded-full bg-[#e546b5] text-white shadow-lg hover:bg-[#f8a8d8]">
      <i class="fas fa-arrow-down"></i>
    </button>
  </div>
  
  <!-- Modal Produk -->
  <div id="productModal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 product-modal">
    <div class="modal-content rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto relative">
      <div class="p-6">
        <div class="flex justify-between items-center mb-4">
          <h2 id="modalProductName" class="text-2xl font-bold text-[#3a0e2a]"></h2>
          <button id="closeModal" class="text-gray-500 hover:text-gray-700 p-2 rounded-full hover:bg-gray-100 transition">
            <i class="fas fa-times text-lg"></i>
          </button>
        </div>
        
        <div class="grid grid-cols-1 gap-6">
          <div class="modal-image-container p-6 rounded-xl">
            <img id="modalProductImage" src="" alt="Product" class="rounded-lg w-full max-h-64 object-contain mx-auto">
          </div>
          
          <div class="space-y-5">
            <div>
              <span class="font-semibold text-[#e546b5] text-sm uppercase tracking-wider">Tipe Produk:</span>
              <p id="modalProductType" class="mt-1 text-gray-700 text-lg"></p>
            </div>
            <div>
              <span class="font-semibold text-[#e546b5] text-sm uppercase tracking-wider">Ingredients:</span>
              <p id="modalIngredients" class="mt-1 text-gray-600 text-sm text-justifyleading-relaxed"></p>
            </div>
            <div>
              <span class="font-semibold text-[#e546b5] text-sm uppercase tracking-wider">Deskripsi:</span>
              <p id="modalDescription" class="mt-1 text-gray-700 text-justify"></p>
            </div>
            <div>
              <span class="font-semibold text-[#e546b5] text-sm uppercase tracking-wider">Harga:</span>
              <p id="modalPrice" class="mt-1 text-xl font-bold text-[#e546b5]"></p>
            </div>
            <div>
              <span class="font-semibold text-[#e546b5] text-sm uppercase tracking-wider">Tipe Kulit:</span>
              <p id="modalSkinType" class="mt-1 text-gray-700 text-lg"></p>
            </div>
            <div>
              <span class="font-semibold text-[#e546b5] text-sm uppercase tracking-wider">Manfaat:</span>
              <p id="modalManfaat" class="mt-1 text-gray-700 text-justifytext-lg"></p>
            </div>
            <div>
              <span class="font-semibold text-[#e546b5] text-sm uppercase tracking-wider">Cara Pakai:</span>
              <p id="modalCaraPakai" class="mt-1 text-gray-700 text-lg text-justify"></p>
            </div>
            
            <!-- Location Section -->
            <div>
              <span class="font-semibold text-[#e546b5] text-sm uppercase tracking-wider">Lokasi:</span>
              <div class="mt-2">
                <div class="flex space-x-2 mb-4">
                  <button class="location-tab px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-[#e546b5] hover:text-white transition" data-location-index="0">Lokasi Raodah Beauty</button>
                  <button class="location-tab px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-[#e546b5] hover:text-white transition" data-location-index="1">Lokasi Wcare</button>
                  <button class="location-tab px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-[#e546b5] hover:text-white transition" data-location-index="2">Lokasi FLBeauty</button>
                </div>
                <div id="modalLocation" class="w-full h-64 rounded-lg overflow-hidden">
                  <!-- Location iframe will be inserted here -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal Pedoman -->
  <div id="guideModal" class="guide-modal">
    <div class="guide-modal-content">
      <div class="bg-gradient-to-r from-[#e546b5] to-[#f8a8d8] p-5 rounded-t-2xl">
        <div class="flex justify-between items-center">
          <h2 class="text-white text-2xl font-bold"><i class="fas fa-book mr-2"></i> Pedoman Penggunaan</h2>
          <button id="closeGuideModal" class="text-white hover:text-gray-200 p-2 rounded-full">
            <i class="fas fa-times text-lg"></i>
          </button>
        </div>
      </div>
      
      <div class="p-6 bg-white">
        <div class="mb-8">
          <h3 class="text-lg font-bold text-[#3a0e2a] mb-4">Cara Menggunakan Asisten Virtual Skincare</h3>
          <p class="text-gray-600 mb-5">Berikut panduan lengkap untuk memanfaatkan asisten virtual dengan maksimal:</p>
          
          <div class="space-y-5">
            <div class="guide-step">
              <div class="step-number">1</div>
              <div>
                <h4 class="font-bold text-[#e546b5] mb-1">Mulai Percakapan</h4>
                <p class="text-gray-700">Ketik pertanyaan di kolom input di bagian bawah halaman. Contoh: "Saya punya kulit berminyak, facial wash apa yang cocok?"</p>
              </div>
            </div>
            
            <div class="guide-step">
              <div class="step-number">2</div>
              <div>
                <h4 class="font-bold text-[#e546b5] mb-1">Tanya Tentang Produk</h4>
                <p class="text-gray-700">Anda bisa menanyakan informasi tentang produk seperti manfaat, kandungan, harga, atau cara pakai. Contoh: "Manfaat GARNIER SAKURA GLOW GLOWING FACE WASH?"</p>
              </div>
            </div>
            
            <div class="guide-step">
              <div class="step-number">3</div>
              <div>
                <h4 class="font-bold text-[#e546b5] mb-1">Dapatkan Rekomendasi</h4>
                <p class="text-gray-700">Asisten akan memberikan rekomendasi produk berdasarkan tipe kulit, masalah kulit, atau preferensi Anda. Contoh: "Rekomendasi serum untuk kulit kering"</p>
              </div>
            </div>
            
            <div class="guide-step">
              <div class="step-number">4</div>
              <div>
                <h4 class="font-bold text-[#e546b5] mb-1">Lihat Detail Produk</h4>
                <p class="text-gray-700">Klik tombol "Detail" pada kartu produk untuk melihat informasi lengkap termasuk lokasi penjualan.</p>
              </div>
            </div>
          </div>
        </div>
        
        <div class="bg-[#fff9fc] p-4 rounded-xl border border-[#ffd6f0]">
  <h4 class="font-bold text-[#e546b5] mb-2 flex items-center">
    <i class="fas fa-lightbulb mr-2"></i> Contoh Pertanyaan
  </h4>
  <div class="copy-question-button grid grid-cols-1 md:grid-cols-2 gap-3">
    <div class="bg-white p-3 rounded-lg border border-[#f8a8d8] cursor-pointer hover:bg-[#f8a8d8]/20 question" data-question="Sunscreen untuk kulit sensitif">
      <p class="text-gray-700">"Sunscreen untuk kulit sensitif"</p>
    </div>
    <div class="copy-question-button bg-white p-3 rounded-lg border border-[#f8a8d8] cursor-pointer hover:bg-[#f8a8d8]/20 question" data-question="Moisturizer untuk kulit jerawat dengan harga di bawah 100 ribu">
      <p class="text-gray-700">"Moisturizer untuk kulit jerawat dengan harga di bawah 100 ribu"</p>
    </div>
    <div class="copy-question-button bg-white p-3 rounded-lg border border-[#f8a8d8] cursor-pointer hover:bg-[#f8a8d8]/20 question" data-question="Serum untuk kulit kering yang mengandung niacinamide">
      <p class="text-gray-700">"Serum untuk kulit kering yang mengandung niacinamide"</p>
    </div>
  </div>
</div>

      
      <div class="bg-[#fff9fc] p-5 rounded-b-2xl text-center">
        <button id="startChatButton" class="bg-gradient-to-r from-[#e546b5] to-[#f8a8d8] text-white px-6 py-3 rounded-full font-medium hover:opacity-90 transition">
          Mulai Chat Sekarang
        </button>
      </div>
    </div>
  </div>
  
  <!-- Color Gradient Bar -->
  <div class="color-gradient-bar"></div>

  <script>
    // Menambahkan event listener pada div yang berisi pertanyaan
document.querySelectorAll('.question').forEach(function(item) {
  item.addEventListener('click', function() {
    // Get the question text from the clicked element
    const questionText = item.getAttribute('data-question');
    const cleanedText = questionText.replace(/"/g, '').trim();  // Clean up extra quotes if any
    // Update the displayed question text
    document.getElementById('userInput').value = cleanedText;
    
     const guideModal = document.getElementById('guideModal');
    guideModal.style.display = 'none'; // Menutup modal dengan mengubah display ke 'none'
    document.body.style.overflow = 'auto'; // Mengembalikan overflow ke normal setelah menutup modal
  });
});
document.addEventListener('click', function(e) {
    // Handle tombol rekomendasi lainnya
    if (e.target.classList.contains('suggesst-one') || 
       e.target.classList.contains('suggesst-two') || 
       e.target.classList.contains('suggesst-three') || 
       (e.target.classList.contains('feedback-btn') && e.target.dataset.feedback === 'more')) {
        
        // Sembunyikan semua tombol saran di pesan yang sama
        const parentBubble = e.target.closest('.bot-message-bubble');
        if (parentBubble) {
            const suggestionButtons = parentBubble.querySelectorAll(
                '.suggesst-one, .suggesst-two, .suggesst-three, .feedback-btn.more'
            );
            suggestionButtons.forEach(button => {
                button.classList.add('cursor-not-allowed');
            });
        }

        // Tentukan pertanyaan berdasarkan tombol yang ditekan
        let question = "";
        if (e.target.classList.contains('suggesst-one')) {
            question = "Moisturizer untuk kulit sensitif";
        } else if (e.target.classList.contains('suggesst-two')) {
            question = "Sunscreen untuk kulit kering dibawah 100 ribu";
        } else if (e.target.classList.contains('suggesst-three')) {
            question = "manfaat garnier sakura glow glowing face wash";
        } else {
            question = "rekomendasi lainnya";
        }

        handleMoreRecommendations(question);
    }
    
    // Handle feedback positif/negatif (opsional)
    else if (e.target.classList.contains('feedback-btn')) {
        handleFeedback(e.target.dataset.feedback);
    }
});

// Fungsi untuk meminta rekomendasi lainnya
async function handleMoreRecommendations(test) {
    addMessage(test, 'user');
    scrollToBottom();
    isProcessing = true;
    toggleButtonState(true);

    await new Promise(resolve => setTimeout(resolve, 300));
    
    addTyping();
    
    try {
        const lastBotMessage = document.querySelector('.bot-message-bubble:last-child');
        const context = lastBotMessage ? lastBotMessage.textContent.substring(0, 100) : '';
        
        const res = await fetch('/ask', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                message: test,
                context: context
            })
        });

        const data = await res.json();
        removeTyping();

        if (data.status === 'success') {
            const lastBotElement = document.querySelector('.flex.justify-start.mb-4:last-child');
            if (lastBotElement) lastBotElement.remove();
            addHtmlMessage(data.response);
        } else {
            addMessage('‚ö†Ô∏è ' + data.response, 'bot');
        }
    } catch (err) {
        removeTyping();
        addMessage('‚ö†Ô∏è Error memuat ' + test, 'bot');
        console.error(err);
    } finally {
        isProcessing = false;
        toggleButtonState(false);
    }
}
    function showProductDetail(productName) {
      fetch('../static/data.json')
        .then(response => response.json())
        .then(products => {
          const product = products.find(p => p.nama === productName);
          if (product) {
            document.getElementById('modalProductName').textContent = product.nama;
            
            // Encode nama produk untuk URL
            const encodedProductName = encodeURIComponent(product.nama);
            document.getElementById('modalProductImage').src = `static/data.1/${encodedProductName}.JPG`;
            
            document.getElementById('modalProductType').textContent = product["tipe produk"] || 'N/A';
            
            const ingredients = product.ingredients ? 
              (Array.isArray(product.ingredients) ? product.ingredients.join(', ') : product.ingredients) 
              : 'N/A';
            document.getElementById('modalIngredients').textContent = ingredients;
            
            document.getElementById('modalDescription').textContent = product.deskripsi || 'N/A';
            document.getElementById('modalPrice').textContent = product.harga ? `Rp ${product.harga}` : 'N/A';
            document.getElementById('modalSkinType').textContent = product["tipe kulit"] || 'N/A';

            const locationTabs = document.querySelectorAll('.location-tab');
            const modalLocation = document.getElementById('modalLocation');

            locationTabs.forEach((tab, index) => {
              tab.addEventListener('click', () => {
                const productName = document.getElementById('modalProductName').textContent;
                fetch('../static/data.json')
                  .then(response => response.json())
                  .then(products => {
                    const product = products.find(p => p.nama === productName);
                    if (product) {
                      const iframe = product.lokasi[index];
                      modalLocation.innerHTML = iframe;
                    } else {
                      console.error('Produk tidak ditemukan');
                    }
                  })
                  .catch(error => {
                    console.error('Error fetching product data:', error);
                    alert('Terjadi kesalahan saat memuat data produk');
                  });
              });
            });
            
            const manfaat = product.manfaat ? 
              (Array.isArray(product.manfaat) ? product.manfaat.join(', ') : product.manfaat) 
              : 'N/A';
            document.getElementById('modalManfaat').textContent = manfaat;
            
            document.getElementById('modalCaraPakai').textContent = product.cara_pakai || 'N/A';
            document.getElementById('productModal').classList.remove('hidden');
          } else {
            alert('Produk tidak ditemukan');
          }
        })
        .catch(error => {
          console.error('Error fetching product data:', error);
          alert('Terjadi kesalahan saat memuat data produk');
        });
    }
    
    // Add event listener for detail button
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('detail-btn')) {
        const productName = e.target.dataset.productName;
        showProductDetail(productName);
      }
    });

    // Modal close handlers
    document.getElementById('closeModal').addEventListener('click', function() {
      document.getElementById('productModal').classList.add('hidden');
    });

    document.getElementById('productModal').addEventListener('click', function(e) {
      if (e.target === this) {
        this.classList.add('hidden');
      }
    });

    // Guide modal functionality
    const guideButton = document.getElementById('guideButton');
    const guideModal = document.getElementById('guideModal');
    const closeGuideModal = document.getElementById('closeGuideModal');
    const startChatButton = document.getElementById('startChatButton');

    // Open guide modal
    guideButton.addEventListener('click', () => {
      guideModal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    });

    // Close guide modal
    closeGuideModal.addEventListener('click', () => {
      guideModal.style.display = 'none';
      document.body.style.overflow = 'auto';
    });

    // Close when clicking outside modal
    guideModal.addEventListener('click', (e) => {
      if (e.target === guideModal) {
        guideModal.style.display = 'none';
        document.body.style.overflow = 'auto';
      }
    });

    // Start chat button in guide modal
    startChatButton.addEventListener('click', () => {
      guideModal.style.display = 'none';
      document.body.style.overflow = 'auto';
      userInput.focus();
    });

    // Chat functionality
    const chatForm = document.getElementById('chatForm');
    const userInput = document.getElementById('userInput');
    const chatMessages = document.getElementById('chatMessages');
    const submitButton = document.getElementById('submitButton');
    const sendIcon = document.getElementById('sendIcon');
    const loadingIcon = document.getElementById('loadingIcon');
    const scrollUpButton = document.getElementById('scrollUpButton');
    const scrollDownButton = document.getElementById('scrollDownButton');
    const chatContainer = document.getElementById('chatContainer');

    let isProcessing = false;

    // Animated scroll functions
    function scrollToBottom() {
      animateScroll(chatContainer.scrollHeight, 500);
    }

    function scrollToTop() {
      animateScroll(0, 500);
    }

    function scrollUp() {
      animateScroll(chatContainer.scrollTop - 150, 300);
    }

    function scrollDown() {
      animateScroll(chatContainer.scrollTop + 150, 300);
    }

    function animateScroll(targetPosition, duration) {
      const startPosition = chatContainer.scrollTop;
      const distance = targetPosition - startPosition;
      const startTime = performance.now();
      
      function scrollAnimation(currentTime) {
        const elapsedTime = currentTime - startTime;
        const progress = Math.min(elapsedTime / duration, 1);
        const easeProgress = easeOutCubic(progress);
        
        chatContainer.scrollTop = startPosition + (distance * easeProgress);
        
        if (progress < 1) {
          requestAnimationFrame(scrollAnimation);
        } else {
          updateScrollButtons();
        }
      }
      
      requestAnimationFrame(scrollAnimation);
    }

    function easeOutCubic(t) {
      return 1 - Math.pow(1 - t, 3);
    }

    function updateScrollButtons() {
      // Check if there's enough content to scroll
      const hasScroll = chatContainer.scrollHeight > chatContainer.clientHeight;
      
      if (!hasScroll) {
        scrollUpButton.classList.remove('visible');
        scrollDownButton.classList.remove('visible');
        return;
      }
      
      // Check if we're at the top
      const isAtTop = chatContainer.scrollTop === 0;
      
      // Check if we're at the bottom (with a small tolerance)
      const isAtBottom = chatContainer.scrollHeight - chatContainer.scrollTop <= chatContainer.clientHeight + 10;
      
      // Update button visibility with animation
      scrollUpButton.classList.toggle('visible', !isAtTop);
      scrollDownButton.classList.toggle('visible', !isAtBottom);
    }

    // Event listeners for scroll buttons
    scrollUpButton.addEventListener('click', scrollUp);
    scrollDownButton.addEventListener('click', scrollDown);
    
    // Scroll to top and bottom buttons
    scrollDownButton.addEventListener('dblclick', scrollToBottom);
    scrollUpButton.addEventListener('dblclick', scrollToTop);

    // Monitor scroll events
    chatContainer.addEventListener('scroll', updateScrollButtons);
    
    // Adjust input width on resize
    function adjustInputWidth() {
      const formWidth = chatForm.offsetWidth;
      const buttonWidth = submitButton.offsetWidth;
      const padding = 16;
      userInput.style.maxWidth = `${formWidth - buttonWidth - padding}px`;
    }

    // Initial adjustment and on resize
    window.addEventListener('load', () => {
      adjustInputWidth();
      userInput.focus();
      // Check scroll buttons after a short delay to allow rendering
      setTimeout(updateScrollButtons, 500);
    });
    
    window.addEventListener('resize', () => {
      adjustInputWidth();
      updateScrollButtons();
    });

    // Form submission
    chatForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (isProcessing) return;
      
      const message = userInput.value.trim();
      if (!message) return;

      isProcessing = true;
      toggleButtonState(true);
      
      addMessage(message, 'user');
      userInput.value = '';
      addTyping();

      try {
        const res = await fetch('/ask', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message })
        });

        const data = await res.json();
        removeTyping();

        if (data.status === 'success') {
          if (data.response_type === 'html') {
            addHtmlMessage(data.response);
          } else {
            addMessage(data.response, 'bot');
          }
        } else {
          addMessage('‚ö†Ô∏è ' + data.response, 'bot');
        }
      } catch (err) {
        removeTyping();
        addMessage('‚ö†Ô∏è Server error, please try again later.', 'bot');
        console.error(err);
      } finally {
        isProcessing = false;
        toggleButtonState(false);
        userInput.focus();
        // Wait for the message to render and then update scroll buttons
        setTimeout(updateScrollButtons, 100);
      }
    });

    function toggleButtonState(processing) {
      submitButton.disabled = processing;
      if (processing) {
        sendIcon.classList.add('hidden');
        loadingIcon.classList.remove('hidden');
      } else {
        loadingIcon.classList.add('hidden');
        sendIcon.classList.remove('hidden');
      }
    }

    function addMessage(msg, sender) {
      const isUser = sender === 'user';
      const wrapper = document.createElement('div');
      wrapper.className = `flex justify-${isUser ? 'end' : 'start'} mb-4`;

      const messageDiv = document.createElement('div');
      messageDiv.className = isUser 
        ? 'user-message-bubble px-5 py-3'
        : 'bot-message-bubble px-5 py-3';

      const messageText = document.createElement('p');
      messageText.className = isUser 
        ? 'text-white break-words whitespace-pre-wrap'
        : 'text-gray-800 break-words whitespace-pre-wrap';
      messageText.textContent = msg;

      // Timestamp
      const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      const timeStamp = document.createElement('p');
      timeStamp.className = isUser 
        ? 'text-xs text-white/80 mt-2 text-right' 
        : 'text-xs text-gray-400 mt-2 text-right';
      timeStamp.textContent = timestamp;

      messageDiv.appendChild(messageText);
      messageDiv.appendChild(timeStamp);
      wrapper.appendChild(messageDiv);
      chatMessages.appendChild(wrapper);
      scrollToBottom();
    }

    function addHtmlMessage(htmlContent) {
      const wrapper = document.createElement('div');
      wrapper.className = 'flex justify-start mb-4';

      const content = document.createElement('div');
      content.className = 'flex items-end space-x-3 w-full';

      const messageDiv = document.createElement('div');
      messageDiv.className = 'flex-1 bot-message-bubble px-5 py-3';
      messageDiv.innerHTML = htmlContent;

      const timestamp = document.createElement('p');
      timestamp.className = 'text-xs text-gray-400 mt-2 text-right';
      timestamp.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      messageDiv.appendChild(timestamp);

      content.appendChild(messageDiv);
      wrapper.appendChild(content);
      chatMessages.appendChild(wrapper);

      scrollToBottom();
    }

    function addTyping() {
      const typing = document.createElement('div');
      typing.id = 'typingIndicator';
      typing.className = 'flex justify-start mb-4';

      typing.innerHTML = ` 
        <div class="flex items-end space-x-3 w-full">
          <div class="typing-indicator px-5 py-3">
            <div class="flex space-x-2 items-center">
              <div class="w-2 h-2 rounded-full bg-[#e546b5] animate-bounce"></div>
              <div class="w-2 h-2 rounded-full bg-[#f8a8d8] animate-bounce" style="animation-delay: .2s"></div>
              <div class="w-2 h-2 rounded-full bg-[#ffd6f0] animate-bounce" style="animation-delay: .4s"></div>
            </div>
          </div>
        </div>
      `;
      chatMessages.appendChild(typing);
      scrollToBottom();
    }

    function removeTyping() {
      const typing = document.getElementById('typingIndicator');
      if (typing) typing.remove();
    }

    // Allow sending with Enter key
    userInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        chatForm.dispatchEvent(new Event('submit'));
      }
    });
  </script>
</body>
</html>